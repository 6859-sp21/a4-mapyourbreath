<!DOCTYPE html>
<html>
  <head>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <title>UFO Sightings</title>
    <meta charset="UTF-8" />
    <!-- Bootstrap Plugins -->
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>
    <!-- CSS Style Sheet -->
    <link rel="stylesheet" href="./src/styles.css" />
    <style> /* set the CSS */
      div.tooltip {
        position: absolute;
        text-align: left;
        max-width: 400;
        height: auto;
        padding: 5px;
        font: 10px sans-serif;
        color: rgb(0, 0, 0);
        /* background: rgb(27, 27, 27); */
        border: 0px;
        border-radius: 2px;
        pointer-events: none;
        /* padding-top: 10px;
        padding-right: 10px;
        padding-bottom: 10px;
        padding-left: 10px; */
      }
      div.witnessAccount {
        position: absolute;
        /* left: width + 30; */
        background: black;
        /* top: height + 100; */
        text-align: left;
        width: 400;
        height: auto;
        padding: 2px;
        font: 12px sans-serif;
        color: rgb(255, 255, 255);
        background: rgb(0, 0, 0);
        border: 0px;
        border-radius: 2px;
        pointer-events: none;
        padding-top: 10px;
        padding-right: 10px;
        padding-bottom: 10px;
        padding-left: 10px;
        border-style: solid;
        border-width: 3px;
        border-color:rgb(235, 255, 119);
      }
    </style>
  </head>

  <body>
    <!-- Header -->
    <div class="header">
      <h1>ARE WE ALONE?</h1>
      <h7>UFO Sightings 1969-2019</h7>
    </div>
    <!-- Instructions -->
    <div class="narrative">
      <p>
        Discover 70,000 sightings & stories that have occured throughout history
        as we have come face to face with the possibility of other inhabitants
        in our universe. Come see if an extraterrestrial visitor was near your
        home!
      </p>
    </div>

    <!-- Filters -->
    <div>
      <div class="container-fluid">
        <div class="row filter-row1">
          <!-- Need to Edit Padding in CSS file -->
          <!-- State -->
          <div class="col-6 state-filter-div">
            <div class="dropdown">
              <button
                class="btn btn-sm btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Select State
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">California</a></li>
                <li><a class="dropdown-item" href="#">Texas</a></li>
                <li><a class="dropdown-item" href="#">Arkansas</a></li>
                <li><a class="dropdown-item" href="#">New York</a></li>
                <li><a class="dropdown-item" href="#">Oregon</a></li>
              </ul>
            </div>
          </div>

          <div class="col-6 sort-filter-div">
            <div class="dropdown">
              <button
                class="btn btn-sm btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton1"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Sort Stories
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a class="dropdown-item" href="#">Shape</a></li>
                <li><a class="dropdown-item" href="#">Duration</a></li>
                <li><a class="dropdown-item" href="#">Tag</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container-fluid">
        <!-- Year -->
        <!-- Documentation: https://www.w3schools.com/howto/howto_js_rangeslider.asp -->
        <div id="chart" class="slidecontainer filter-row2">
          <p class="instruction-font">Mon:Yr</p>
          <input
            type="range"
            min="1"
            max="100"
            value="50"
            class="slider"
            id="myRange"
          />
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="container-fluid">
      <div class="row">


      <script>
          d3.csv("https://raw.githubusercontent.com/dludgin/githubTest/main/sightingsfrom2005.csv").then((sightings) => {

        const duration = 150;
        const data = sightings.filter(d => d.durationMin < duration);
        

        //visualization's space
        const height = 400;
        const width = 500;;
        const margin = ({top: 10, right: 10, bottom: 50, left: 20});
        
        //actual svg, above variable control this sizing
        const svg = d3.create('svg')
          .attr('width', width)
          .attr('height', height)
          // .style('background', "black");
        
        // 4. Setting up scales.
        const xScale = d3.scaleLinear()
          .domain([0, 12])
          .range([margin.left, width - margin.right])
          .nice();

        const yScale = d3.scaleLinear()
          .domain([0, duration])
          .range([height - margin.bottom, margin.top])
          .nice();

        const colorScale = d3.scaleOrdinal()
          .domain(sightings.map(d => d.cluster))
          .range(d3.schemeTableau10);
      
        
        var tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

        var witnessAccount = d3.select("body").append("div")
        .attr("class", "witnessAccount")
        .style("opacity", 0);
      
        const symbol = d3.symbol();
        svg.append('g')
          .selectAll('path') // d3-shape functions (like d3.symbol) generate attributes for SVG <path> elements
          .data(data)
          .join('path')
          .attr('transform', d => `translate(${xScale(d.Month)}, ${yScale(d.durationMin)})`)
          .attr('fill', "rgb(235, 255, 119)")
          .attr('d', d => symbol()) // Notice, the output of the d3.symbol is wired up to the "d" attribute.
          .on("mouseover", function(event, d) {
             tooltip.transition()
               .duration(200)
               .style("opacity", .9);
             tooltip.html("(Double click for full witness account) <br/>" + "Date: " + d.Date + "<br/>Duration: " + d.durationMin + " minutes <br/>" + "Shape: " + d.Shape + "<br/> <br/> Witness's Account Summary: " + d.Summary)
               .style("left", 20)
              //  .style("background", "black")
               .style("top", 20);

              d3.select(this)
                .attr("fill", "black")
                .attr("d", symbol.size(64 * 4));
             })
           .on("mouseout", function(event, d) {
             tooltip.transition()
               .duration(500)
               .style("opacity", 0);

             d3.select(this)
                .attr("fill", "rgb(235, 255, 119)")
                .attr("d", symbol.size(64));

           })
            
            .on('click', (event, d) => {
              witnessAccount.transition()
               .duration(200)
                .style("opacity", .9);
              witnessAccount.html("Date: " + d.Date + "<br/>Duration: " + d.durationMin + " minutes <br/>" + "Shape: " + d.Shape + "<br/> <br/> Witness's Account: <br/>" + d.Text + "<br/> <br/> Link to Report: <br/>" + d.report_link)
                .style("left", width + 30)
                // .style("background", "black")
                .style("top", 80);
              
              // d3.select(this)
              //   .attr("fill", "yellow")
              //   .attr("d", symbol.size(64 * 4));

            })

        svg.append('g')
          .attr('transform', `translate(0, ${height - margin.bottom})`)
          .call(d3.axisBottom(xScale))
          // Add x-axis title 'text' element.
          .append('text')
            .attr('text-anchor', 'end')
            .attr('fill', 'black')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .attr('x', width - margin.right)
            .attr('y', 30)
            .text('Month');

        //7. Drawing our y-axis
        svg.append('g')
          .attr('transform', `translate(${margin.left}, 0)`)
          .call(d3.axisLeft(yScale))
          // Add y-axis title 'text' element.
          .append('text')
            .attr('transform', `translate(20, ${margin.top}) rotate(-90)`)
            .attr('text-anchor', 'end')
            .attr('fill', 'black')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .text('Duration (minutes)');


        document.getElementById("chart").appendChild(svg.node());
      });
      </script>
